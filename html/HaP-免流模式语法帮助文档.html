<!DOCTYPE html>
<script>
  var host = "hyxxsfwy.github.io";
  if ((host == window.location.host) && (window.location.protocol != "https:"))
	window.location.protocol = "https";

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51773802-2', 'auto');
  ga('send', 'pageview');
</script>
<html><head><meta name="viewport" content="width=device-width, initial-scale=0.8"><link rel="canonical" href="https://hyxxsfwy.github.io/2016/01/30/HaP免流模式语法帮助文档/"><title>HaP免流模式语法帮助文档</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style>

.note-content  {font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif;}
</style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-933" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-934" class="wmd-preview-section preview-content">
<h1 id="hap免流模式语法帮助文档">HaP免流模式语法帮助文档</h1>

<div><div class="toc"><div class="toc">
<ul>
<li><a href="#hap免流模式语法帮助文档">HaP免流模式语法帮助文档</a><ul>
<li><a href="#1-配置参数">1. 配置参数</a><ul>
<li><a href="#11-global">1.1 global</a><ul>
<li><a href="#111-daemon">1.1.1 daemon</a></li>
<li><a href="#112-user-group">1.1.2 user group</a></li>
<li><a href="#113-maxconn">1.1.3 maxconn</a></li>
<li><a href="#114-chroot">1.1.4 chroot</a></li>
<li><a href="#115-pidfile">1.1.5 pidfile</a></li>
</ul>
</li>
<li><a href="#12-defaults">1.2 defaults</a><ul>
<li><a href="#121-timeout-connect">1.2.1 timeout connect</a></li>
<li><a href="#122-timeout-client">1.2.2 timeout client</a></li>
<li><a href="#123-timeout-server">1.2.3 timeout server</a></li>
<li><a href="#124-stats">1.2.4 stats</a></li>
<li><a href="#125-option-redispatch">1.2.5 option redispatch</a></li>
<li><a href="#126-option-abortonclose">1.2.6 option abortonclose</a></li>
<li><a href="#127-option-httpclose">1.2.7 option httpclose</a></li>
</ul>
</li>
<li><a href="#13-frontend">1.3 frontend</a><ul>
<li><a href="#131-mode-http">1.3.1 mode http</a></li>
<li><a href="#132-option-accept-invalid-http-request">1.3.2 option accept-invalid-http-request</a></li>
<li><a href="#133-acl-httpgps-method-getposthttps">1.3.3 acl http_g/p/s method GET/POST/HTTPS</a></li>
<li><a href="#134-usebackend-http-getposthttps-if-httpgps">1.3.4 use_backend http-get/post/https if http_g/p/s</a></li>
<li><a href="#135-defaultbackend-https">1.3.5 default_backend https</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-请求处理语法">2. 请求处理语法</a><ul>
<li><a href="#21-中文语法">2.1 中文语法</a><ul>
<li><a href="#211-添加一行">2.1.1 添加一行</a></li>
<li><a href="#212-设置行值">2.1.2 设置行值</a></li>
<li><a href="#213-设置行值2">2.1.3 设置行值2</a></li>
<li><a href="#214-删除一行">2.1.4 删除一行</a></li>
<li><a href="#215-删除一行2">2.1.5 删除一行2</a></li>
<li><a href="#216-替换字符串">2.1.6 替换字符串</a></li>
<li><a href="#217-之前添加">2.1.7 之前添加</a></li>
<li><a href="#218-之后添加">2.1.8 之后添加</a></li>
<li><a href="#219-行前添加">2.1.9 行前添加</a></li>
<li><a href="#2110-行后添加">2.1.10 行后添加</a></li>
<li><a href="#2111-行值前添加">2.1.11 行值前添加</a></li>
<li><a href="#2112-行值后添加">2.1.12 行值后添加</a></li>
<li><a href="#2113-url前添加">2.1.13 URL前添加</a></li>
<li><a href="#2114-url后添加">2.1.14 URL后添加</a></li>
<li><a href="#2115-删除网址httphost">2.1.15 删除网址http://host</a></li>
<li><a href="#2116-删除se">2.1.16 删除s_e</a></li>
<li><a href="#2117-删除se2">2.1.17 删除s_e2</a></li>
<li><a href="#2118-atob-a-b">2.1.18 atob a b</a></li>
<li><a href="#2119-设置第一行-str">2.1.19 设置第一行 str</a></li>
<li><a href="#2120-设置行名-hdra-hdrb">2.1.20 设置行名 hdrA hdrB</a></li>
</ul>
</li>
<li><a href="#22-英语语法">2.2 英语语法</a><ul>
<li><a href="#221-add-header">2.2.1 add-header</a></li>
<li><a href="#222-set-header">2.2.2 set-header</a></li>
<li><a href="#223-set-header2">2.2.3 set-header2</a></li>
<li><a href="#226-add-replacestrrepalce">2.2.6 add-replace(str_repalce)</a></li>
<li><a href="#227-add-before">2.2.7 add-before</a></li>
<li><a href="#228-add-after">2.2.8 add-after</a></li>
<li><a href="#229-add-lbefore">2.2.9 add-lbefore</a></li>
<li><a href="#2210-add-lafter">2.2.10 add-lafter</a></li>
<li><a href="#2211-add-vbefore">2.2.11 add-vbefore</a></li>
<li><a href="#2212-add-vafter">2.2.12 add-vafter</a></li>
<li><a href="#2213-add-ubfore">2.2.13 add-ubfore</a></li>
<li><a href="#2214-add-uafter">2.2.14 add-uafter</a></li>
<li><a href="#2215-atob-a-b">2.2.15 atob a b</a></li>
<li><a href="#2216-rep-hvalue">2.2.16 rep-hvalue</a></li>
<li><a href="#2217-mov-fhttp">2.2.17 mov-fhttp</a></li>
<li><a href="#2218-mov-se-s-e">2.2.18 mov-se s e</a></li>
<li><a href="#2219-mov-nse-s-e">2.2.19 mov-nse s e</a></li>
<li><a href="#2220-set-req-fline-str">2.2.20 set-req-fline str</a></li>
<li><a href="#2221-rn-header-hdra-hdrb">2.2.21 rn-header hdrA hdrB</a></li>
<li><a href="#2222-xhosttot">2.2.22 xhostTot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#3特殊用法">3.特殊用法</a><ul>
<li><a href="#31-xxx操作">3.1 %[xxx]操作</a><ul>
<li><a href="#310-headerxxxx">3.1.0  %[header(xxxx)]</a></li>
<li><a href="#311-url">3.1.1 %[url]</a></li>
<li><a href="#312-requesturi">3.1.2 %[request_uri]</a></li>
<li><a href="#313-reqhdrxxx">3.1.3 %[req.hdr(xxx)]</a></li>
<li><a href="#314-method">3.1.4 %[method]</a></li>
<li><a href="#315-reqver">3.1.5 %[req.ver]</a></li>
<li><a href="#316-urlnoport">3.1.6 %[url_no_port]</a></li>
<li><a href="#317-host">3.1.7 %[host]</a></li>
<li><a href="#318-thost">3.1.8 %[t_host]</a></li>
<li><a href="#319-xhost">3.1.9 %[xhost]</a></li>
</ul>
</li>
<li><a href="#32-核心函数">3.2 核心函数</a><ul>
<li><a href="#321-未完待续">3.2.1 未完待续</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>

</div><div id="wmd-preview-section-935" class="wmd-preview-section preview-content">

<h2 id="1-配置参数">1. 配置参数</h2>

<p>本文是HaP核心的配置文件详解，比如<code>global</code>,<code>defaults</code>之类的能看到的配置语法，都可以在这里找到注释</p>

</div><div id="wmd-preview-section-936" class="wmd-preview-section preview-content">

<h3 id="11-global">1.1 global</h3>

<p><code>global</code>在配置文件中，主要设置一些全局性的参数，起重要作用 <br>
一般建议不要修改，特别是pid文件地址，如果修改了可能会导致无法正常停止HaP核心</p>

</div><div id="wmd-preview-section-937" class="wmd-preview-section preview-content">

<h4 id="111-daemon">1.1.1 daemon</h4>

<p>HaP核心运行方式为：后台运行</p>

</div><div id="wmd-preview-section-938" class="wmd-preview-section preview-content">

<h4 id="112-user-group">1.1.2 user group</h4>

<p><code>user - group</code>  <br>
设置HAP核心工作所属的用户和组</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-939" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置HAP核心工作的用户和组为:inet</span><br><span class="hljs-comment line-number">2.</span> user inet<br><span class="hljs-comment line-number">3.</span> group inet <br><span class="hljs-comment line-number">4.</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">###################################</span><br><span class="hljs-comment line-number">6.</span><br><span class="hljs-comment line-number">7.</span> <span class="hljs-comment">#设置HAP核心工作的用户和组为:root</span><br><span class="hljs-comment line-number">8.</span> user root <br><span class="hljs-comment line-number">9.</span> group root<br></code></pre>

<!--more-->

</div><div id="wmd-preview-section-940" class="wmd-preview-section preview-content">

<h4 id="113-maxconn">1.1.3 maxconn</h4>

<p>设置每个进程可用的最大连接数</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-941" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置每个进程可用的最大连接数20480</span><br><span class="hljs-comment line-number">2.</span> maxconn 20480<br></code></pre>

</div><div id="wmd-preview-section-942" class="wmd-preview-section preview-content">

<h4 id="114-chroot">1.1.4 chroot</h4>

<p>改变当前工作目录 <br>
一般不需要添加，所以在配置语法中这句是注释掉的，也不推荐使用，因为 pidfile 文件的路径是相对路径，这个会干扰 pidfile 文件的存放地址</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-943" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置工作目录为HaP的私有目录</span><br><span class="hljs-comment line-number">2.</span> chroot /data/data/com.HaP.Byml/files<br><span class="hljs-comment line-number">3.</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#/data/data/com.HaP.Byml/files目录</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#就是HaP的私有目录</span><br></code></pre>

</div><div id="wmd-preview-section-944" class="wmd-preview-section preview-content">

<h4 id="115-pidfile">1.1.5 pidfile</h4>

<p>haproxy的pid存放路径，启动进程的用户必须有权限访问此文件 <br>
不推荐修改这个地址，修改以后会干扰自带的HAP停止脚本</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-945" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置pidfile文件地址</span><br><span class="hljs-comment line-number">2.</span> pidfile ./haproxy.pid <br><span class="hljs-comment line-number">3.</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#上面的配置会使在配置文件相同的目录下创建pid文件</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#及这就是相对目录，建议默认就这样</span><br></code></pre>

</div><div id="wmd-preview-section-946" class="wmd-preview-section preview-content">

<h3 id="12-defaults">1.2 defaults</h3>

<p>默认的一个模块，一些超时和一些缺省值需要要设置的参数在这个模块设置</p>

</div><div id="wmd-preview-section-947" class="wmd-preview-section preview-content">

<h4 id="121-timeout-connect">1.2.1 timeout connect</h4>

<p>超时参数：连接超时 <br>
如果一个连接超过了超时参数设置的值没有进行响应操作，就会自动断开连接，返回一个错误的报文</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-948" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置连接超时为：30000ms</span><br><span class="hljs-comment line-number">2.</span> timeout connect 30000ms<br></code></pre>

</div><div id="wmd-preview-section-949" class="wmd-preview-section preview-content">

<h4 id="122-timeout-client">1.2.2 timeout client</h4>

<p>超时参数：客户端超时 <br>
如果客户端超过了超时参数设置的值没有进行响应操作，就会自动断开连接，返回一个错误的报文</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-950" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置客户端超时为：300000ms</span><br><span class="hljs-comment line-number">2.</span> timeout client 300000ms<br></code></pre>

</div><div id="wmd-preview-section-951" class="wmd-preview-section preview-content">

<h4 id="123-timeout-server">1.2.3 timeout server</h4>

<p>超时参数：服务器端超时 <br>
如果服务器端超过了超时参数设置的值没有进行响应操作，就会自动断开连接，返回一个错误的报文</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-952" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设服务器端超时为：3000000ms</span><br><span class="hljs-comment line-number">2.</span> timeout server 30000ms<br></code></pre>

</div><div id="wmd-preview-section-953" class="wmd-preview-section preview-content">

<h4 id="124-stats">1.2.4 stats</h4>

<p>设置HaProxy的状态网页 <br>
由于有些模式修改过的请求，会干扰HAP核心的识别状态页面，所以推荐用默认透明模式进行访问状态页面</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-954" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置HaP核心的状态页面为/hap</span><br><span class="hljs-comment line-number">2.</span> stats uri /hap<br></code></pre>

<p>在默认透明模式下访问<code>http://127.0.0.1:监听端口/hap</code> 就可以进入状态网页</p>

</div><div id="wmd-preview-section-955" class="wmd-preview-section preview-content">

<h4 id="125-option-redispatch">1.2.5 option redispatch</h4>

<p>serverId对应的服务器挂掉后，强制定向到其他健康的服务器</p>

</div><div id="wmd-preview-section-956" class="wmd-preview-section preview-content">

<h4 id="126-option-abortonclose">1.2.6 option abortonclose</h4>

<p>当服务器负载很高的时候，自动结束掉当前队列处理比较久的连接</p>

</div><div id="wmd-preview-section-957" class="wmd-preview-section preview-content">

<h4 id="127-option-httpclose">1.2.7 option httpclose</h4>

<p>每次请求完毕后主动关闭HTTP通道 <br>
老版本的HAProxy不支持<code>keep-alive</code>模式 ，HAProxy会针对客户端的第一条请求的返回添加cookie并返回给客户端，客户端发送后续请求时会发送此cookie到HAProxy，HAProxy会针对此cookie分发到上次处理此请求的服务器上，如果服务器不能忽略此cookie值会影响处理结果。 <br>
要避免这种情况可配置此选项，防止产生多余的cookie信息。</p>

</div><div id="wmd-preview-section-958" class="wmd-preview-section preview-content">

<h3 id="13-frontend">1.3 frontend</h3>

<p>前端配置，可以在里面进行请求方法过滤和拦截请求操作</p>

</div><div id="wmd-preview-section-959" class="wmd-preview-section preview-content">

<h4 id="131-mode-http">1.3.1 mode http</h4>

<p><code>mode { tcp|http|health }</code>   设定启动的实例的协议类型 <br>
非对HAP核心了解的用户禁止修改，修改后可能导致无法上网</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-960" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置协议类型为http协议</span><br><span class="hljs-comment line-number">2.</span> mode http<br></code></pre>

</div><div id="wmd-preview-section-961" class="wmd-preview-section preview-content">

<h4 id="132-option-accept-invalid-http-request">1.3.2 option accept-invalid-http-request</h4>

<p>允许接受错误的HTTP请求 <br>
有些模式修改后，会使得核心识别为错误的请求，导致直接返回一个错误请求，无法上网。要避免，加上此选项就行。</p>

</div><div id="wmd-preview-section-962" class="wmd-preview-section preview-content">

<h4 id="133-acl-httpgps-method-getposthttps">1.3.3 acl http_g/p/s method GET/POST/HTTPS</h4>

<p><code>acl</code> 操作 <br>
上面的<code>http_g/p/s</code>会在后面用的，相当于<code>if</code>语句的条件</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-963" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#判断请求模式是否为GET</span><br><span class="hljs-comment line-number">2.</span> acl http_g method GET<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#如果为GET http_g就为true</span><br><span class="hljs-comment line-number">4.</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#判断请求模式是否为POST</span><br><span class="hljs-comment line-number">6.</span> acl http_p method POST<br><span class="hljs-comment line-number">7.</span> <span class="hljs-comment">#如果为GET http_p就为true</span><br><span class="hljs-comment line-number">8.</span><br><span class="hljs-comment line-number">9.</span> <span class="hljs-comment">#判断请求模式是否为CONNECT(https)</span><br><span class="hljs-comment line-number">10.</span> acl http_s method CONNECT<br><span class="hljs-comment line-number">11.</span> <span class="hljs-comment">#如果为GET http_s就为true</span><br></code></pre>

</div><div id="wmd-preview-section-964" class="wmd-preview-section preview-content">

<h4 id="134-usebackend-http-getposthttps-if-httpgps">1.3.4 use_backend http-get/post/https if http_g/p/s</h4>

<p>如果<code>acl</code>操作的值为<code>true</code>,</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-965" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#如果http_g为true就使用http-get模块</span><br><span class="hljs-comment line-number">2.</span> use_backend http-get if http_g<br><span class="hljs-comment line-number">3.</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#如果http_p为true就使用http-post模块</span><br><span class="hljs-comment line-number">5.</span> use_backend http-post if http_p<br><span class="hljs-comment line-number">6.</span><br><span class="hljs-comment line-number">7.</span> <span class="hljs-comment">#如果http_s为true就使用https模块</span><br><span class="hljs-comment line-number">8.</span> use_backend https if http_s<br></code></pre>

</div><div id="wmd-preview-section-966" class="wmd-preview-section preview-content">

<h4 id="135-defaultbackend-https">1.3.5 default_backend https</h4>

<p>默认使用的模块，当请求方法非<code>get/post/https</code>时，就会启用</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-967" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置默认模块为:https</span><br><span class="hljs-comment line-number">2.</span> default_backend https<br></code></pre>

</div><div id="wmd-preview-section-968" class="wmd-preview-section preview-content">

<h2 id="2-请求处理语法">2. 请求处理语法</h2>

</div><div id="wmd-preview-section-969" class="wmd-preview-section preview-content">

<h3 id="21-中文语法">2.1 中文语法</h3>

<p>添加中文语法的主要原因，是英文语法多多少少有些繁琐，不易写模式，而且很多友友都不懂英文语法，甚至看到英文就头疼。 <br>
添加中文语法对HaP的效率没有影响，最终的处理的都和英文语法一样。中文语法中的语句，都可以在英文语法里找到相同的作用的语法。 <br>
HaP是一款免费的软件，希望大家能尽量分享一些，多帮助些新人，这样才能发展HaP。</p>

</div><div id="wmd-preview-section-970" class="wmd-preview-section preview-content">

<h4 id="211-添加一行">2.1.1 添加一行</h4>

<p>在请求中添加一行请求</p>

<ul><li><p>原型 <br>
<code>请求 添加一行 hanme value</code></p></li>
<li><p>参数</p>

<ul>
<li>参数1：<code>hname</code> 必填，一行的行头名称</li>
<li>参数2：<code>value</code> 必填，一行的值，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-971" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在请求中添加一行：test: abc\r\n </span><br><span class="hljs-comment line-number">2.</span> 请求 添加一行 test abc<br></code></pre>

</div><div id="wmd-preview-section-972" class="wmd-preview-section preview-content">

<h4 id="212-设置行值">2.1.2 设置行值</h4>

<p>设置一行的值</p>

<ul><li><p>原型 <br>
<code>请求 设置行值 sanme value</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>sname</code> 必填，需要设置的值得行名称</li>
<li>参数2：<code>value</code> 必填，一行的值 ，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中，寻找<code>sname</code>行，如果存在就修改<code>sname</code>行的值，如果不存在就在请求结尾添加<code>sname</code>行，值为<code>value</code></p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-973" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置Host行的值为:10.0.0.172</span><br><span class="hljs-comment line-number">2.</span> 请求 设置行值 Host 10.0.0.172<br></code></pre>

</div><div id="wmd-preview-section-974" class="wmd-preview-section preview-content">

<h4 id="213-设置行值2">2.1.3 设置行值2</h4>

<p>设置一行的值（与<code>设置行值</code>一致）</p>

<ul><li><p>原型 <br>
<code>请求 设置行值2 sanme value</code></p></li>
<li><p>参数</p>

<ul>
<li>参数1：<code>sname</code> 必填，需要设置的值得行名称</li>
<li>参数2：<code>value</code> 必填，一行的值 ，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中，寻找<code>sname</code>行，如果存在就修改<code>sname</code>行的值，如果不存在就在请求结尾添加<code>sname</code>行，值为<code>value</code></p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-975" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置Host行的值为:10.0.0.172</span><br><span class="hljs-comment line-number">2.</span> 请求 设置行值2 Host 10.0.0.172<br></code></pre>

</div><div id="wmd-preview-section-976" class="wmd-preview-section preview-content">

<h4 id="214-删除一行">2.1.4 删除一行</h4>

<p>删除请求中的一行</p>

<ul><li><p>原型 <br>
<code>请求 删除一行 danme</code></p></li>
<li><p>参数</p>

<ul>
<li>参数1：<code>dname</code> 必填，需要删除的行名称</li></ul></li>
</ul>

<p>会删除请求中的<code>dname</code>行</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-977" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除请求中的Host行</span><br><span class="hljs-comment line-number">2.</span> 请求 删除一行 Host<br></code></pre>

</div><div id="wmd-preview-section-978" class="wmd-preview-section preview-content">

<h4 id="215-删除一行2">2.1.5 删除一行2</h4>

<p>删除请求中的一行（与<code>删除一行</code>一致）</p>

<ul><li><p>原型 <br>
<code>请求 删除一行2 danme</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>dname</code> 必填，需要删除的行名称</li></ul></li>
</ul>

<p>会删除请求中的<code>dname</code>行</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-979" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除请求中的Host行</span><br><span class="hljs-comment line-number">2.</span> 请求 删除一行2 Host<br></code></pre>

</div><div id="wmd-preview-section-980" class="wmd-preview-section preview-content">

<h4 id="216-替换字符串">2.1.6 替换字符串</h4>

<p>替换请求中指定的字符串</p>

<ul><li><p>原型 <br>
<code>请求 替换字符串 str1 str2</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>str1</code> 必填，需要被替换的字符串，支持<code>%[xxx]</code>操作</li>
<li>参数2：<code>str2</code> 必填 ，需要替换的字符串</li></ul></li>
</ul>

<p>在请求中，把<code>str1</code>字符串替换为<code>str2</code>字符串</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-981" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#修改HTTP协议版本为:1.0</span><br><span class="hljs-comment line-number">2.</span> 请求 替换字符串 HTTP/1.1 HTTP/1.0<br><span class="hljs-comment line-number">3.</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#把Host行替换成X-Online-Host行</span><br><span class="hljs-comment line-number">5.</span> 请求 替换字符串 \nHost: \nX-Online-Host:<br></code></pre>

</div><div id="wmd-preview-section-982" class="wmd-preview-section preview-content">

<h4 id="217-之前添加">2.1.7 之前添加</h4>

<p>在请求中某一个字符串前面添加字符串</p>

<ul><li><p>原型 <br>
<code>请求 之前添加 name str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>name</code> 必填，确定在哪一个字符串前面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中的的<code>name</code>字符串前添加<code>str</code>字符串</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-983" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行前面添加一行：test,值为abc</span><br><span class="hljs-comment line-number">2.</span> 请求 之前添加 Host: test:\ abc\r\n<br></code></pre>

</div><div id="wmd-preview-section-984" class="wmd-preview-section preview-content">

<h4 id="218-之后添加">2.1.8 之后添加</h4>

<p>在请求中指定字符串后面添加字符串</p>

<ul><li><p>原型 <br>
<code>请求 之后添加 name str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>name</code> 必填，确定在哪个字符串后面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中的<code>name</code>行后面添加<code>str</code>字符串</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-985" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在首行下面添新的一行test 值为abc</span><br><span class="hljs-comment line-number">2.</span> 请求 之后添加 \n test:\ abc\r\n<br></code></pre>

</div><div id="wmd-preview-section-986" class="wmd-preview-section preview-content">

<h4 id="219-行前添加">2.1.9 行前添加</h4>

<p>在请求中某一行前面添加字符串</p>

<ul><li><p>原型 <br>
<code>请求 行前添加 name str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行前面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中的的<code>name</code>行前添加<code>str</code>字符串</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-987" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行前面添加一行：test,值为abc</span><br><span class="hljs-comment line-number">2.</span> 请求 行前添加 Host test:\ abc\r\n    <br></code></pre>

</div><div id="wmd-preview-section-988" class="wmd-preview-section preview-content">

<h4 id="2110-行后添加">2.1.10 行后添加</h4>

<p>在请求中某一行后面添加字符串</p>

<ul><li><p>原型 <br>
<code>请求 行后添加 name str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行后面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中的的<code>name</code>行后面添加<code>str</code>字符串</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-989" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行后面添加一行：test,值为abc</span><br><span class="hljs-comment line-number">2.</span> 请求 行后添加 Host test:\ abc\r\n<br></code></pre>

</div><div id="wmd-preview-section-990" class="wmd-preview-section preview-content">

<h4 id="2111-行值前添加">2.1.11 行值前添加</h4>

<p>在一行值的前面添加字符串</p>

<ul><li><p>原型 <br>
<code>请求 行值前添加 name str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行值的前面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在请求中的的<code>name</code>的值前面添加添加<code>str</code>字符串</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-991" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行值前面添加字符串：abc</span><br><span class="hljs-comment line-number">2.</span> 请求 行值前添加 Host abc<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#如果Host行整行为:Host: wap.baidu.com\r\n</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#那么使用上面的Host行就会变成：Host:abcwap.baidu.com\r\n</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#这个时候Host行值的前面增加了abc，这就是'行值前添加'语法的作用</span><br></code></pre>

</div><div id="wmd-preview-section-992" class="wmd-preview-section preview-content">

<h4 id="2112-行值后添加">2.1.12 行值后添加</h4>

<ul><li><p>原型 <br>
<code>请求 行值后添加 name str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行值的后面</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-993" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行值后面添加abc</span><br><span class="hljs-comment line-number">2.</span> 请求 行值后添加 Host abc<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#如果Host行的整行为:Host: wap.baidu.com\r\n</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#使用上面的语法后Host整行为：Host: wap.baidu.comabc\r\n</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#这个时候Host行值后面添加了abc，这就是'行值后添加'语法的作用</span><br></code></pre>

</div><div id="wmd-preview-section-994" class="wmd-preview-section preview-content">

<h4 id="2113-url前添加">2.1.13 URL前添加</h4>

<ul><li><p>原型 <br>
<code>请求 URL前添加 str</code></p></li>
<li><p>参数</p>

<ul>
<li>参数1：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-995" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在请求URL之前添加字符串str</span><br><span class="hljs-comment line-number">2.</span> 请求 URL前添加 str<br></code></pre>

</div><div id="wmd-preview-section-996" class="wmd-preview-section preview-content">

<h4 id="2114-url后添加">2.1.14 URL后添加</h4>

<ul><li><p>原型 <br>
<code>请求 URL后添加 str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-997" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">##在请求URL之后添加字符串str</span><br><span class="hljs-comment line-number">2.</span> 请求 URL后添加 str<br></code></pre>

</div><div id="wmd-preview-section-998" class="wmd-preview-section preview-content">

<h4 id="2115-删除网址httphost">2.1.15 删除网址<code>http://host</code></h4>

<ul><li><p>原型 <br>
<code>请求 删除网址http://host null null</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1： 可选，默认<code>null</code>即可</li>
<li>参数2： 可选，默认<code>null</code>即可</li></ul></li>
</ul>

<p>在请求的第一行通常是这样的 <br>
<code>GET(method) http://wap.baidu.com/?from=xxx</code> <br>
由于某些特殊修改请求的方法，需要去掉请求中的<code>http://wap.baidu.com</code> <br>
所以出现了上面的语法，语法跟<code>mov-fhttp null null</code>作用一样</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-999" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除网址http://host</span><br><span class="hljs-comment line-number">2.</span> 请求 删除网址http://host null null<br></code></pre>

</div><div id="wmd-preview-section-1000" class="wmd-preview-section preview-content">

<h4 id="2116-删除se">2.1.16 删除s_e</h4>

<ul><li><p>原型 <br>
<code>请求 删除s_e start end</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>start</code> 必填,开始字符</li>
<li>参数2：<code>end</code> 必填，结束字，支持<code>%[xxx]</code>操作符</li></ul></li>
</ul>

<p>删除<code>start</code>到<code>end</code>之间的字符，保留<code>end</code></p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-1001" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除网址http://host</span><br><span class="hljs-comment line-number">2.</span> 请求 删除s_e http:// /<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#上面的语句的作用就等于删除网址http://</span><br></code></pre>

</div><div id="wmd-preview-section-1002" class="wmd-preview-section preview-content">

<h4 id="2117-删除se2">2.1.17 删除s_e2</h4>

<ul><li><p>原型 <br>
<code>请求 删除s_e2 start end</code></p></li>
<li><p>参数</p>

<ul>
<li>参数1：<code>start</code> 必填，开始的字符</li>
<li>参数2：<code>end</code> 结束的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>删除<code>start</code>到<code>end</code>的字符，删除<code>end</code>，跟<code>删除s_e</code>的区别就是<code>s_e</code>保留了<code>end</code>,这个语法删除了<code>end</code></p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-1003" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除Host行</span><br><span class="hljs-comment line-number">2.</span> 请求 删除s_e2 Host \r\n<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#上面的语法的意思是删除：以Host开头到以\r\n结尾的字符串，开头和结尾都删除</span><br></code></pre>

</div><div id="wmd-preview-section-1004" class="wmd-preview-section preview-content">

<h4 id="2118-atob-a-b">2.1.18 atob a b</h4>

<p>主要用于转换行头（行头就是一行的名字，通常有<code>host行</code>的叫法，就是因为行头为<code>Host</code>）  <br>
如果a行存在，那么行头就替换成b行，b行不管存不存在都会被删除 <br>
如果a行的值为空，那么a行将会被删除，b行保留</p>

<ul><li><p>原型 <br>
<code>请求 atob a b</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>a</code> 必填，A行</li>
<li>参数2：<code>b</code> 必填，B行</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1005" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#X-Online-Host转Host</span><br><span class="hljs-comment line-number">2.</span> 请求 atob X-Online-Host Host<br></code></pre>

</div><div id="wmd-preview-section-1006" class="wmd-preview-section preview-content">

<h4 id="2119-设置第一行-str">2.1.19 设置第一行 str</h4>

<p>自定义请求的第一行</p>

<ul><li><p>原型 <br>
<code>请求 设置第一行 str</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：<code>str</code> 必填，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1007" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#具体事例 http://host转http://proxy_host</span><br><span class="hljs-comment line-number">2.</span> 请求 设置第一行 %[method]\ http://prxoy_host%[request_uri]\ HTTP/1.1\r\n<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#%[method] 请求方法 GET/POST/CONNECT</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#%[request_uri] 请求url 跟php的REQUEST_URI类似</span><br></code></pre>

</div><div id="wmd-preview-section-1008" class="wmd-preview-section preview-content">

<h4 id="2120-设置行名-hdra-hdrb">2.1.20 设置行名 hdrA hdrB</h4>

<p>设置一行请求的行名</p>

<ul><li><p>原型 <br>
<code>请求 设置行名 hdrA hdrB</code></p></li>
<li><p>参数 </p>

<ul>
<li>参数1：`hdrA 需要被改名的请求行必填</li>
<li>参数1： 将要改为的行名</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1009" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#Host行改为T_Host行</span><br><span class="hljs-comment line-number">2.</span> 请求 设置行名 Host T_Host<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#就把Host行的行名：Host改为了T_Host</span><br></code></pre>

</div><div id="wmd-preview-section-1010" class="wmd-preview-section preview-content">

<h3 id="22-英语语法">2.2 英语语法</h3>

<p>这里语法的作用都是同上面中文语法的 <br>
英文语法在后来的版本中对原来的语法进行优化和修复 <br>
在1.5版本后,set-header/2,del-header/2全部为自定义语法 <br>
这样做的目的是为了稳定性和安全性考虑</p>

</div><div id="wmd-preview-section-1011" class="wmd-preview-section preview-content">

<h4 id="221-add-header">2.2.1 add-header</h4>

<p>添加一行</p>

<ul><li><p>原型 <br>
<code>http-request add-header h v</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，需要添加的行</li>
<li><code>v</code>： 必填，需要添加行的值，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>添加新的一行，行头为<code>h</code>，值为<code>v</code></p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-1012" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#添加test行，值为abc</span><br><span class="hljs-comment line-number">2.</span> http-request add-header test abc<br></code></pre>

</div><div id="wmd-preview-section-1013" class="wmd-preview-section preview-content">

<h4 id="222-set-header">2.2.2 set-header</h4>

<p>设置一行的值</p>

<ul><li><p>原型 <br>
<code>http-request set-header h v</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，需要修改值的行</li>
<li><code>v</code>： 必填，需要修改的值，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>设置<code>h</code>行的值为<code>v</code>，不会修改位置</p>

</div><div id="wmd-preview-section-1014" class="wmd-preview-section preview-content">

<h4 id="223-set-header2">2.2.3 set-header2</h4>

<p>设置一行的值</p>

<ul><li><p>原型 <br>
<code>http-request set-header2 h v</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，需要修改值的行</li>
<li><code>v</code>： 必填，需要修改的值，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1015" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#设置Host行的值为10.0.0.172</span><br><span class="hljs-comment line-number">2.</span> http-request set-header2 Host 10.0.0.172<br></code></pre>

<p>2.2.4 del-header <br>
删除请求中的一行</p>

<ul><li><p>原型 <br>
<code>http-request del-header h</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，被删除的行头</li></ul></li>
</ul>

<p>删除请求中的<code>h</code>行</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-1016" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除请求中的Host行</span><br><span class="hljs-comment line-number">2.</span> http-request del-header Host<br></code></pre>

<p>2.2.5 del-header2</p>

<p>删除请求中的一行，与<code>del-heder</code>语法的区别就是此语法更稳当，<code>del-header</code>语法为开发语法</p>

<ul><li><p>原型 <br>
<code>http-request del-header2 h</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，被删除的行头</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1017" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除请求中Host行</span><br><span class="hljs-comment line-number">2.</span> http-request del-header2 Host<br></code></pre>

</div><div id="wmd-preview-section-1018" class="wmd-preview-section preview-content">

<h4 id="226-add-replacestrrepalce">2.2.6 add-replace(str_repalce)</h4>

<p>替换请求中的字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-replace(str_replace) str1 str2</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>str1</code>： 必填，被替换的字符串，支持<code>%[xxx]</code>操作</li>
<li><code>str2</code>： 必填，替换的字符串</li></ul></li>
</ul>

<p>把请求中的<code>str1</code>字符串替换成<code>str2</code>字符串</p>

<p>示例</p>

</div><div id="wmd-preview-section-1019" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#更改http协议版本为1.0</span><br><span class="hljs-comment line-number">2.</span> http-request add-replace HTTP/1.1 HTTP/1.0<br></code></pre>

</div><div id="wmd-preview-section-1020" class="wmd-preview-section preview-content">

<h4 id="227-add-before">2.2.7 add-before</h4>

<p>在指定字符串前面添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-before name str</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>name</code>： 必填，定位在哪个字符串前面添加字符串</li>
<li><code>str</code>： 必填，需要添加的字符串 ，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1021" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#Host行前添加一行test,值为abc</span><br><span class="hljs-comment line-number">2.</span> http-request add-before Host test:\ abc\r\n<br></code></pre>

</div><div id="wmd-preview-section-1022" class="wmd-preview-section preview-content">

<h4 id="228-add-after">2.2.8 add-after</h4>

<p>在指定字符串后面添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-after name str</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>name</code>： 必填，定位在哪个字符后面添加字符</li>
<li><code>str</code>： 必填，要添加的字符，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1023" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在首行下面添加一个Host 值为test</span><br><span class="hljs-comment line-number">2.</span> http-rrequest add-after \n Host:\ test\r\n<br></code></pre>

</div><div id="wmd-preview-section-1024" class="wmd-preview-section preview-content">

<h4 id="229-add-lbefore">2.2.9 add-lbefore</h4>

<p>在指定行之前添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-lbefore h str</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，在指定的行前</li>
<li><code>str</code>： 必填， 添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1025" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行前添加新的一行test值为abc</span><br><span class="hljs-comment line-number">2.</span> http-request add-lbeofore Host test:\ abc\r\n<br></code></pre>

</div><div id="wmd-preview-section-1026" class="wmd-preview-section preview-content">

<h4 id="2210-add-lafter">2.2.10 add-lafter</h4>

<p>在指定行后添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-lafter h str</code></p></li>
<li><p>参数</p>

<ul>
<li><code>h</code>： 必填，在指定的行后</li>
<li><code>str</code>： 必填， 添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1027" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行后添加新的一行:test行值为：abv</span><br><span class="hljs-comment line-number">2.</span> http-request add-lafter Host test:\ abc\r\n<br></code></pre>

</div><div id="wmd-preview-section-1028" class="wmd-preview-section preview-content">

<h4 id="2211-add-vbefore">2.2.11 add-vbefore</h4>

<p>在指定行后的值前面添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-vbefore h v</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 必填，确定在哪一行值的前面添加字符串</li>
<li><code>v</code>： 必填，添加的字符串 ，支持<code>%[xxx]</code>操作</li></ul></li>
</ul>

<p>在<code>h</code>行的值后面添加字符串<code>v</code></p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-1029" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="hljs smali"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行值前面添加字符串：abc</span><br><span class="hljs-comment line-number">2.</span> http-request<span class="hljs-instruction"> add-vbefore </span>Host abc<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#如果Host行整行为:Host: wap.baidu.com\r\n</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#那么使用上面的Host行就会变成：Host:abcwap.baidu.com\r\n</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#这个时候Host行值的前面增加了abc，这就是'add-hbefore'法的作用</span><br></code></pre>

</div><div id="wmd-preview-section-1030" class="wmd-preview-section preview-content">

<h4 id="2212-add-vafter">2.2.12 add-vafter</h4>

<p>在指定行的值后面添加</p>

<ul><li><p>原型 <br>
<code>http-request add-vafter h v</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 指定哪个行值后面添加字符串</li>
<li><code>v</code>： 需要添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1031" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在Host行值后面添加abc</span><br><span class="hljs-comment line-number">2.</span> http-request add-vafter Host abc<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#如果Host行的整行为:Host: wap.baidu.com\r\n</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#使用上面的语法后Host整行为：Host: wap.baidu.comabc\r\n</span><br><span class="hljs-comment line-number">5.</span> <span class="hljs-comment">#这个时候Host行值后面添加了abc</span><br></code></pre>

</div><div id="wmd-preview-section-1032" class="wmd-preview-section preview-content">

<h4 id="2213-add-ubfore">2.2.13 add-ubfore</h4>

<p>在请求URL前面添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-ubefore str</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>str</code>： 添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1033" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在请求url前添加'http://bml.net'</span><br><span class="hljs-comment line-number">2.</span> http-request ubefore http://byml.net<br></code></pre>

</div><div id="wmd-preview-section-1034" class="wmd-preview-section preview-content">

<h4 id="2214-add-uafter">2.2.14 add-uafter</h4>

<p>在请求URL之后添加字符串</p>

<ul><li><p>原型 <br>
<code>http-request add-uafter str</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>str</code>： 添加的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1035" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#在请求URL后面添加字符串?abc</span><br><span class="hljs-comment line-number">2.</span> http-request add-uafter ?abc<br></code></pre>

</div><div id="wmd-preview-section-1036" class="wmd-preview-section preview-content">

<h4 id="2215-atob-a-b">2.2.15 atob a b</h4>

<p>a行转b行</p>

<ul><li><p>原型 <br>
<code>http-request atob a b</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>a</code>： a行</li>
<li><code>b</code>： b行</li></ul></li>
</ul>

<p>如果a行存在，b行存在，则会把b行删除，把a行的行头改成b <br>
如果a行的值为空，则会删除a行，保留b行 <br>
如果a行不存在，则不会做任何处理</p>

<ul><li>示例</li>
</ul>

</div><div id="wmd-preview-section-1037" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#X-Online-Host转Host</span><br><span class="hljs-comment line-number">2.</span> http-request atob X-Online-Host Host<br></code></pre>

</div><div id="wmd-preview-section-1038" class="wmd-preview-section preview-content">

<h4 id="2216-rep-hvalue">2.2.16 rep-hvalue</h4>

<p>修改一行的值，如果不存在行就不添加</p>

<ul><li><p>原型 <br>
<code>http-request rep-hvalue h v</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>h</code>： 修改值的行</li>
<li><code>v</code>： 需要修改成的值，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1039" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#修改host行的值为byml.net，如果不存在则不做任何处理</span><br><span class="hljs-comment line-number">2.</span> http-request rep-havlue Host byml.net<br></code></pre>

</div><div id="wmd-preview-section-1040" class="wmd-preview-section preview-content">

<h4 id="2217-mov-fhttp">2.2.17 mov-fhttp</h4>

<p>删除请求网址开头：<code>http://host</code></p>

<ul><li><p>原型 <br>
<code>http-request mov-fhttp null null</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>null</code>： 默认即可</li>
<li><code>null</code>： 默认即可，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1041" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#使用例子</span><br><span class="hljs-comment line-number">2.</span> http-request mov-fhttp null null<br></code></pre>

</div><div id="wmd-preview-section-1042" class="wmd-preview-section preview-content">

<h4 id="2218-mov-se-s-e">2.2.18 mov-se s e</h4>

<p>删除以<code>s</code>开头到<code>e</code>结尾的字符串，保留<code>e</code></p>

<ul><li><p>原型 <br>
<code>http-request mov-se s e</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>s</code>： 开始的字符串</li>
<li><code>e</code>： 结束的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1043" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除请求地址中的http://host</span><br><span class="hljs-comment line-number">2.</span> http-request mov-se http:// /<br></code></pre>

</div><div id="wmd-preview-section-1044" class="wmd-preview-section preview-content">

<h4 id="2219-mov-nse-s-e">2.2.19 mov-nse s e</h4>

<p>删除以<code>s</code>开头到<code>e</code>结尾的字符串，删除<code>e</code></p>

<ul><li><p>原型 <br>
<code>http-request mov-nse s e</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>s</code>： 开始的字符串</li>
<li><code>e</code>： 结束的字符串，支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1045" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#删除Host行</span><br><span class="hljs-comment line-number">2.</span> http-request mov-nse Host \r\n<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#一行的结束标志是\r\n</span><br></code></pre>

</div><div id="wmd-preview-section-1046" class="wmd-preview-section preview-content">

<h4 id="2220-set-req-fline-str">2.2.20 set-req-fline str</h4>

<p>自定义请求的第一行</p>

<ul><li><p>原型 <br>
<code>http-request set-req-fline str</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>str</code>： 支持<code>%[xxx]</code>操作</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1047" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#http://host转http://proxy_host</span><br><span class="hljs-comment line-number">2.</span> http-request set-req-fline %[method]\ http://proxy_host%[request_uri]\ HTTP/1.1\r\n <br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#%[method] 请求方法 GET/POST/CONNECT</span><br><span class="hljs-comment line-number">4.</span> <span class="hljs-comment">#%[request_uri] 请求的url 跟php的REQUEST_URI类似 </span><br></code></pre>

</div><div id="wmd-preview-section-1048" class="wmd-preview-section preview-content">

<h4 id="2221-rn-header-hdra-hdrb">2.2.21 rn-header hdrA hdrB</h4>

<p>设置一行请求的行名</p>

<ul><li><p>原型 <br>
<code>http-request rn-header hdrA hdrB</code></p></li>
<li><p>参数 </p>

<ul>
<li><code>hdrA</code>： 被改名的请求行</li>
<li><code>hdrB</code>： 需要改为的名称</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1049" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> <span class="hljs-comment">#Host行改为T_Host</span><br><span class="hljs-comment line-number">2.</span> http-request rn-header Host T_Host<br><span class="hljs-comment line-number">3.</span> <span class="hljs-comment">#把Host行的请求名：Host 改为了T_Host</span><br></code></pre>

</div><div id="wmd-preview-section-1050" class="wmd-preview-section preview-content">

<h4 id="2222-xhosttot">2.2.22 xhostTot</h4>

<p><code>Xhost</code>,<code>Host</code>（如果没有大写的，则自动查找小写）转换为<code>T_Host</code> <br>
如果<code>xhost</code>,<code>host</code>均存在 <br>
则以<code>xhost</code>优先，把<code>xhost</code>请求行名改为<code>T_Host</code> <br>
如果<code>host</code>行存在，<code>xhost</code>不存在 <br>
则以<code>host</code>行优先，把<code>host</code>行改为<code>T_Host</code>行</p>

<ul><li><p>原型 <br>
<code>http-request xhostTot null null</code></p></li>
<li><p>参数</p>

<ul>
<li><code>null</code>： 无作用，但必须加</li>
<li><code>null</code>： 无作用，但必须加</li></ul></li>
<li><p>示例</p></li>
</ul>

</div><div id="wmd-preview-section-1051" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-light"><code class="language-makefile hljs"><span class="hljs-comment line-number">1.</span> http-request xhostTot null null<br></code></pre>

</div><div id="wmd-preview-section-1052" class="wmd-preview-section preview-content">

<h2 id="3特殊用法">3.特殊用法</h2>

</div><div id="wmd-preview-section-1053" class="wmd-preview-section preview-content">

<h3 id="31-xxx操作">3.1 <code>%[xxx]</code>操作</h3>

<p><code>%[xxx]</code>操作就相当于变量，到了核心就会被转换成这个变量存储的数据</p>

</div><div id="wmd-preview-section-1054" class="wmd-preview-section preview-content">

<h4 id="310-headerxxxx">3.1.0  <code>%[header(xxxx)]</code></h4>

<p>例如：<code>%[header(Host)]</code> <br>
就是取：Host行的值 <br>
这个语法为新增加语法，更适合编写模式</p>

</div><div id="wmd-preview-section-1055" class="wmd-preview-section preview-content">

<h4 id="311-url">3.1.1 <code>%[url]</code></h4>

<p>如果请求的第一行为：<code>GET http://byml.net/index.php HTTP/1.1\r\n</code> <br>
那么<code>%[url]</code>代表的是<code>http://byml.net/index.php</code></p>

</div><div id="wmd-preview-section-1056" class="wmd-preview-section preview-content">

<h4 id="312-requesturi">3.1.2 <code>%[request_uri]</code></h4>

<p>如果请求的第一行为：<code>GET http://byml.net/index.php?user=recall HTTP/1.1\r\n</code> <br>
那么<code>%[request_uri]</code>代表的是：<code>/index.php?user=recall</code></p>

</div><div id="wmd-preview-section-1057" class="wmd-preview-section preview-content">

<h4 id="313-reqhdrxxx">3.1.3 <code>%[req.hdr(xxx)]</code></h4>

<p>例如：<code>%[req.hdr(Accept)]</code> <br>
就是取<code>Accept</code>行的值</p>

<p>如果是要取<code>Host</code>的值 <br>
推荐使用<code>%[host]</code>，这个是固定的，不会出现取值失败，自动停止等BUG</p>

</div><div id="wmd-preview-section-1058" class="wmd-preview-section preview-content">

<h4 id="314-method">3.1.4 <code>%[method]</code></h4>

<p>如果当前的请求方式为<code>GET</code> <br>
那么<code>%[method]</code>的值就是<code>GET</code></p>

</div><div id="wmd-preview-section-1059" class="wmd-preview-section preview-content">

<h4 id="315-reqver">3.1.5 <code>%[req.ver]</code></h4>

<p><code>req.ver</code>是当前使用的HTTP协议的版本 <br>
如果请求是HTTP/1.1 <code>%[req.ver]</code>则为<code>1.1</code> <br>
如果请求是HTTP/1.0 <code>%[req.ver]</code>则为<code>1.0</code></p>

</div><div id="wmd-preview-section-1060" class="wmd-preview-section preview-content">

<h4 id="316-urlnoport">3.1.6 <code>%[url_no_port]</code></h4>

<p>如果<code>CONNECT</code>请求的第一行为<code>CONNECT byml.net:443 HTTP/1.1\r\n</code> <br>
那么<code>%[url_no_port]</code>代表<code>byml.net</code>，目前只推荐在<code>CONNECT</code>请求中使用</p>

</div><div id="wmd-preview-section-1061" class="wmd-preview-section preview-content">

<h4 id="317-host">3.1.7 <code>%[host]</code></h4>

<p>取<code>Host</code>行的值，解决<code>atob</code>后，<code>%[req.hdr(Host)]</code>取不到值的BUG</p>

</div><div id="wmd-preview-section-1062" class="wmd-preview-section preview-content">

<h4 id="318-thost">3.1.8 <code>%[t_host]</code></h4>

<p>取<code>T_Host</code>行的值，可以先把<code>Host</code>字符串修改成<code>T_Host</code> <br>
这样就可以直接<code>%[t_host]</code>取到<code>Host</code>的值，而且只需要定义第一行就行了 </p>

</div><div id="wmd-preview-section-1063" class="wmd-preview-section preview-content">

<h4 id="319-xhost">3.1.9 <code>%[xhost]</code></h4>

<p>取<code>X-Online-Host</code>行的值，固定搭配</p>

</div><div id="wmd-preview-section-1064" class="wmd-preview-section preview-content">

<h3 id="32-核心函数">3.2 核心函数</h3>

</div><div id="wmd-preview-section-1065" class="wmd-preview-section preview-content">

<h4 id="321-未完待续">3.2.1 未完待续</h4></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>