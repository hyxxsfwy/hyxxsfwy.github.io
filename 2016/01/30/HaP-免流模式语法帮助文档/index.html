<!DOCTYPE html><script type="text/javascript">
var host = "hyxxsfwy.github.io";
if ((host == window.location.host) && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>HaP 免流模式语法帮助文档 | Mobilicorpus</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-51773802-2','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">HaP 免流模式语法帮助文档</h1><a id="logo" href="/.">Mobilicorpus</a><p class="description">幻影显形 | Keep Curiosity</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">HaP 免流模式语法帮助文档</h1><div class="post-meta">Jan 30, 2016<span> | </span><span class="category"><a href="/categories/学习/">学习</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a data-disqus-identifier="2016/01/30/HaP-免流模式语法帮助文档/" href="/2016/01/30/HaP-免流模式语法帮助文档/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-配置参数"><span class="toc-text">1. 配置参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-global"><span class="toc-text">1.1 global</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-daemon"><span class="toc-text">1.1.1 daemon</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-user-group"><span class="toc-text">1.1.2 user group</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-maxconn"><span class="toc-text">1.1.3 maxconn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-4-chroot"><span class="toc-text">1.1.4 chroot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-5-pidfile"><span class="toc-text">1.1.5 pidfile</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-defaults"><span class="toc-text">1.2 defaults</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-timeout-connect"><span class="toc-text">1.2.1 timeout connect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-timeout-client"><span class="toc-text">1.2.2 timeout client</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-timeout-server"><span class="toc-text">1.2.3 timeout server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-stats"><span class="toc-text">1.2.4 stats</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5-option-redispatch"><span class="toc-text">1.2.5 option redispatch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-option-abortonclose"><span class="toc-text">1.2.6 option abortonclose</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-7-option-httpclose"><span class="toc-text">1.2.7 option httpclose</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-frontend"><span class="toc-text">1.3 frontend</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-mode-http"><span class="toc-text">1.3.1 mode http</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-option-accept-invalid-http-request"><span class="toc-text">1.3.2 option accept-invalid-http-request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-acl-http-g-p-s-method-GET-POST-HTTPS"><span class="toc-text">1.3.3 acl http_g/p/s method GET/POST/HTTPS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-use-backend-http-get-post-https-if-http-g-p-s"><span class="toc-text">1.3.4 use_backend http-get/post/https if http_g/p/s</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-5-default-backend-https"><span class="toc-text">1.3.5 default_backend https</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-请求处理语法"><span class="toc-text">2. 请求处理语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-中文语法"><span class="toc-text">2.1 中文语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-添加一行"><span class="toc-text">2.1.1 添加一行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-设置行值"><span class="toc-text">2.1.2 设置行值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-设置行值2"><span class="toc-text">2.1.3 设置行值2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-删除一行"><span class="toc-text">2.1.4 删除一行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-删除一行2"><span class="toc-text">2.1.5 删除一行2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-替换字符串"><span class="toc-text">2.1.6 替换字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-7-之前添加"><span class="toc-text">2.1.7 之前添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-8-之后添加"><span class="toc-text">2.1.8 之后添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-9-行前添加"><span class="toc-text">2.1.9 行前添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-10-行后添加"><span class="toc-text">2.1.10 行后添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-11-行值前添加"><span class="toc-text">2.1.11 行值前添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-12-行值后添加"><span class="toc-text">2.1.12 行值后添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-13-URL前添加"><span class="toc-text">2.1.13 URL前添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-14-URL后添加"><span class="toc-text">2.1.14 URL后添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-15-删除网址http-host"><span class="toc-text">2.1.15 删除网址http://host</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-16-删除s-e"><span class="toc-text">2.1.16 删除s_e</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-17-删除s-e2"><span class="toc-text">2.1.17 删除s_e2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-18-atob-a-b"><span class="toc-text">2.1.18 atob a b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-19-设置第一行-str"><span class="toc-text">2.1.19 设置第一行 str</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-20-设置行名-hdrA-hdrB"><span class="toc-text">2.1.20 设置行名 hdrA hdrB</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-英语语法"><span class="toc-text">2.2 英语语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-add-header"><span class="toc-text">2.2.1 add-header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-set-header"><span class="toc-text">2.2.2 set-header</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-set-header2"><span class="toc-text">2.2.3 set-header2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-6-add-replace-str-repalce"><span class="toc-text">2.2.6 add-replace(str_repalce)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-7-add-before"><span class="toc-text">2.2.7 add-before</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-8-add-after"><span class="toc-text">2.2.8 add-after</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-9-add-lbefore"><span class="toc-text">2.2.9 add-lbefore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-10-add-lafter"><span class="toc-text">2.2.10 add-lafter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-11-add-vbefore"><span class="toc-text">2.2.11 add-vbefore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-12-add-vafter"><span class="toc-text">2.2.12 add-vafter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-13-add-ubfore"><span class="toc-text">2.2.13 add-ubfore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-14-add-uafter"><span class="toc-text">2.2.14 add-uafter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-15-atob-a-b"><span class="toc-text">2.2.15 atob a b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-17-mov-fhttp"><span class="toc-text">2.2.17 mov-fhttp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-18-mov-se-s-e"><span class="toc-text">2.2.18 mov-se s e</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-19-mov-nse-s-e"><span class="toc-text">2.2.19 mov-nse s e</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-20-set-req-fline-str"><span class="toc-text">2.2.20 set-req-fline str</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-21-rn-header-hdrA-hdrB"><span class="toc-text">2.2.21 rn-header hdrA hdrB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-22-xhostTot"><span class="toc-text">2.2.22 xhostTot</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-特殊用法"><span class="toc-text">3.特殊用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-xxx-操作"><span class="toc-text">3.1 %[xxx]操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-0-header-xxxx"><span class="toc-text">3.1.0  %[header(xxxx)]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-url"><span class="toc-text">3.1.1 %[url]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-request-uri"><span class="toc-text">3.1.2 %[request_uri]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-req-hdr-xxx"><span class="toc-text">3.1.3 %[req.hdr(xxx)]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-method"><span class="toc-text">3.1.4 %[method]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-req-ver"><span class="toc-text">3.1.5 %[req.ver]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-6-url-no-port"><span class="toc-text">3.1.6 %[url_no_port]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-7-host"><span class="toc-text">3.1.7 %[host]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-8-t-host"><span class="toc-text">3.1.8 %[t_host]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-9-xhost"><span class="toc-text">3.1.9 %[xhost]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-核心函数"><span class="toc-text">3.2 核心函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-未完待续"><span class="toc-text">3.2.1 未完待续</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h2 id="1-配置参数"><a href="#1-配置参数" class="headerlink" title="1. 配置参数"></a>1. 配置参数</h2><p>本文是HaP核心的配置文件详解，比如<code>global</code>,<code>defaults</code>之类的能看到的配置语法，都可以在这里找到注释</p>
<h3 id="1-1-global"><a href="#1-1-global" class="headerlink" title="1.1 global"></a>1.1 global</h3><p><code>global</code>在配置文件中，主要设置一些全局性的参数，起重要作用<br>一般建议不要修改，特别是pid文件地址，如果修改了可能会导致无法正常停止HaP核心</p>
<h4 id="1-1-1-daemon"><a href="#1-1-1-daemon" class="headerlink" title="1.1.1 daemon"></a>1.1.1 daemon</h4><p>HaP核心运行方式为：后台运行</p>
<h4 id="1-1-2-user-group"><a href="#1-1-2-user-group" class="headerlink" title="1.1.2 user group"></a>1.1.2 user group</h4><p><code>user - group</code><br>设置HAP核心工作所属的用户和组</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置HAP核心工作的用户和组为:inet</span></div><div class="line">user inet</div><div class="line">group inet </div><div class="line"></div><div class="line"><span class="comment">###################################</span></div><div class="line"></div><div class="line"><span class="comment">#设置HAP核心工作的用户和组为:root</span></div><div class="line">user root </div><div class="line">group root</div></pre></td></tr></table></figure>
</li>
</ul>
<a id="more"></a>
<h4 id="1-1-3-maxconn"><a href="#1-1-3-maxconn" class="headerlink" title="1.1.3 maxconn"></a>1.1.3 maxconn</h4><p>设置每个进程可用的最大连接数</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置每个进程可用的最大连接数20480</span></div><div class="line">maxconn 20480</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-1-4-chroot"><a href="#1-1-4-chroot" class="headerlink" title="1.1.4 chroot"></a>1.1.4 chroot</h4><p>改变当前工作目录<br>一般不需要添加，所以在配置语法中这句是注释掉的，也不推荐使用，因为 pidfile 文件的路径是相对路径，这个会干扰 pidfile 文件的存放地址</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置工作目录为HaP的私有目录</span></div><div class="line">chroot /data/data/com.HaP.Byml/files</div><div class="line"></div><div class="line"><span class="comment">#/data/data/com.HaP.Byml/files目录</span></div><div class="line"><span class="comment">#就是HaP的私有目录</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-1-5-pidfile"><a href="#1-1-5-pidfile" class="headerlink" title="1.1.5 pidfile"></a>1.1.5 pidfile</h4><p>haproxy的pid存放路径，启动进程的用户必须有权限访问此文件<br>不推荐修改这个地址，修改以后会干扰自带的HAP停止脚本</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置pidfile文件地址</span></div><div class="line">pidfile ./haproxy.pid </div><div class="line"></div><div class="line"><span class="comment">#上面的配置会使在配置文件相同的目录下创建pid文件</span></div><div class="line"><span class="comment">#及这就是相对目录，建议默认就这样</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="1-2-defaults"><a href="#1-2-defaults" class="headerlink" title="1.2 defaults"></a>1.2 defaults</h3><p>默认的一个模块，一些超时和一些缺省值需要要设置的参数在这个模块设置</p>
<h4 id="1-2-1-timeout-connect"><a href="#1-2-1-timeout-connect" class="headerlink" title="1.2.1 timeout connect"></a>1.2.1 timeout connect</h4><p>超时参数：连接超时<br>如果一个连接超过了超时参数设置的值没有进行响应操作，就会自动断开连接，返回一个错误的报文</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置连接超时为：30000ms</span></div><div class="line">timeout connect 30000ms</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-2-2-timeout-client"><a href="#1-2-2-timeout-client" class="headerlink" title="1.2.2 timeout client"></a>1.2.2 timeout client</h4><p>超时参数：客户端超时<br>如果客户端超过了超时参数设置的值没有进行响应操作，就会自动断开连接，返回一个错误的报文</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置客户端超时为：300000ms</span></div><div class="line">timeout client 300000ms</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-2-3-timeout-server"><a href="#1-2-3-timeout-server" class="headerlink" title="1.2.3 timeout server"></a>1.2.3 timeout server</h4><p>超时参数：服务器端超时<br>如果服务器端超过了超时参数设置的值没有进行响应操作，就会自动断开连接，返回一个错误的报文</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设服务器端超时为：3000000ms</span></div><div class="line">timeout server 30000ms</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-2-4-stats"><a href="#1-2-4-stats" class="headerlink" title="1.2.4 stats"></a>1.2.4 stats</h4><p>设置HaProxy的状态网页<br>由于有些模式修改过的请求，会干扰HAP核心的识别状态页面，所以推荐用默认透明模式进行访问状态页面</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置HaP核心的状态页面为/hap</span></div><div class="line">stats uri /hap</div></pre></td></tr></table></figure>
</li>
</ul>
<p>在默认透明模式下访问<code>http://127.0.0.1:监听端口/hap</code> 就可以进入状态网页</p>
<h4 id="1-2-5-option-redispatch"><a href="#1-2-5-option-redispatch" class="headerlink" title="1.2.5 option redispatch"></a>1.2.5 option redispatch</h4><p>serverId对应的服务器挂掉后，强制定向到其他健康的服务器</p>
<h4 id="1-2-6-option-abortonclose"><a href="#1-2-6-option-abortonclose" class="headerlink" title="1.2.6 option abortonclose"></a>1.2.6 option abortonclose</h4><p>当服务器负载很高的时候，自动结束掉当前队列处理比较久的连接</p>
<h4 id="1-2-7-option-httpclose"><a href="#1-2-7-option-httpclose" class="headerlink" title="1.2.7 option httpclose"></a>1.2.7 option httpclose</h4><p>每次请求完毕后主动关闭HTTP通道<br>老版本的HAProxy不支持<code>keep-alive</code>模式 ，HAProxy会针对客户端的第一条请求的返回添加cookie并返回给客户端，客户端发送后续请求时会发送此cookie到HAProxy，HAProxy会针对此cookie分发到上次处理此请求的服务器上，如果服务器不能忽略此cookie值会影响处理结果。<br>要避免这种情况可配置此选项，防止产生多余的cookie信息。</p>
<h3 id="1-3-frontend"><a href="#1-3-frontend" class="headerlink" title="1.3 frontend"></a>1.3 frontend</h3><p>前端配置，可以在里面进行请求方法过滤和拦截请求操作</p>
<h4 id="1-3-1-mode-http"><a href="#1-3-1-mode-http" class="headerlink" title="1.3.1 mode http"></a>1.3.1 mode http</h4><p><code>mode { tcp|http|health }</code>   设定启动的实例的协议类型<br>非对HAP核心了解的用户禁止修改，修改后可能导致无法上网</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置协议类型为http协议</span></div><div class="line">mode http</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-2-option-accept-invalid-http-request"><a href="#1-3-2-option-accept-invalid-http-request" class="headerlink" title="1.3.2 option accept-invalid-http-request"></a>1.3.2 option accept-invalid-http-request</h4><p>允许接受错误的HTTP请求<br>有些模式修改后，会使得核心识别为错误的请求，导致直接返回一个错误请求，无法上网。要避免，加上此选项就行。</p>
<h4 id="1-3-3-acl-http-g-p-s-method-GET-POST-HTTPS"><a href="#1-3-3-acl-http-g-p-s-method-GET-POST-HTTPS" class="headerlink" title="1.3.3 acl http_g/p/s method GET/POST/HTTPS"></a>1.3.3 acl http_g/p/s method GET/POST/HTTPS</h4><p><code>acl</code> 操作<br>上面的<code>http_g/p/s</code>会在后面用的，相当于<code>if</code>语句的条件</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#判断请求模式是否为GET</span></div><div class="line">acl http_g method GET</div><div class="line"><span class="comment">#如果为GET http_g就为true</span></div><div class="line"></div><div class="line"><span class="comment">#判断请求模式是否为POST</span></div><div class="line">acl http_p method POST</div><div class="line"><span class="comment">#如果为GET http_p就为true</span></div><div class="line"></div><div class="line"><span class="comment">#判断请求模式是否为CONNECT(https)</span></div><div class="line">acl http_s method CONNECT</div><div class="line"><span class="comment">#如果为GET http_s就为true</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-4-use-backend-http-get-post-https-if-http-g-p-s"><a href="#1-3-4-use-backend-http-get-post-https-if-http-g-p-s" class="headerlink" title="1.3.4 use_backend http-get/post/https if http_g/p/s"></a>1.3.4 use_backend http-get/post/https if http_g/p/s</h4><p>如果<code>acl</code>操作的值为<code>true</code>,</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#如果http_g为true就使用http-get模块</span></div><div class="line">use_backend http-get if http_g</div><div class="line"></div><div class="line"><span class="comment">#如果http_p为true就使用http-post模块</span></div><div class="line">use_backend http-post if http_p</div><div class="line"></div><div class="line"><span class="comment">#如果http_s为true就使用https模块</span></div><div class="line">use_backend https if http_s</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-5-default-backend-https"><a href="#1-3-5-default-backend-https" class="headerlink" title="1.3.5 default_backend https"></a>1.3.5 default_backend https</h4><p>默认使用的模块，当请求方法非<code>get/post/https</code>时，就会启用</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置默认模块为:https</span></div><div class="line">default_backend https</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-请求处理语法"><a href="#2-请求处理语法" class="headerlink" title="2. 请求处理语法"></a>2. 请求处理语法</h2><h3 id="2-1-中文语法"><a href="#2-1-中文语法" class="headerlink" title="2.1 中文语法"></a>2.1 中文语法</h3><p>添加中文语法的主要原因，是英文语法多多少少有些繁琐，不易写模式，而且很多友友都不懂英文语法，甚至看到英文就头疼。<br>添加中文语法对HaP的效率没有影响，最终的处理的都和英文语法一样。中文语法中的语句，都可以在英文语法里找到相同的作用的语法。<br>HaP是一款免费的软件，希望大家能尽量分享一些，多帮助些新人，这样才能发展HaP。</p>
<h4 id="2-1-1-添加一行"><a href="#2-1-1-添加一行" class="headerlink" title="2.1.1 添加一行"></a>2.1.1 添加一行</h4><p>在请求中添加一行请求</p>
<ul>
<li><p>原型<br><code>请求 添加一行 hanme value</code></p>
</li>
<li><p>参数</p>
<ul>
<li>参数1：<code>hname</code> 必填，一行的行头名称</li>
<li>参数2：<code>value</code> 必填，一行的值，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在请求中添加一行：test: abc\r\n </span></div><div class="line">请求 添加一行 test abc</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-2-设置行值"><a href="#2-1-2-设置行值" class="headerlink" title="2.1.2 设置行值"></a>2.1.2 设置行值</h4><p>设置一行的值</p>
<ul>
<li><p>原型<br><code>请求 设置行值 sanme value</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>sname</code> 必填，需要设置的值得行名称</li>
<li>参数2：<code>value</code> 必填，一行的值 ，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中，寻找<code>sname</code>行，如果存在就修改<code>sname</code>行的值，如果不存在就在请求结尾添加<code>sname</code>行，值为<code>value</code></p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置Host行的值为:10.0.0.172</span></div><div class="line">请求 设置行值 Host 10.0.0.172</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-3-设置行值2"><a href="#2-1-3-设置行值2" class="headerlink" title="2.1.3 设置行值2"></a>2.1.3 设置行值2</h4><p>设置一行的值（与<code>设置行值</code>一致）</p>
<ul>
<li><p>原型<br><code>请求 设置行值2 sanme value</code></p>
</li>
<li><p>参数</p>
<ul>
<li>参数1：<code>sname</code> 必填，需要设置的值得行名称</li>
<li>参数2：<code>value</code> 必填，一行的值 ，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中，寻找<code>sname</code>行，如果存在就修改<code>sname</code>行的值，如果不存在就在请求结尾添加<code>sname</code>行，值为<code>value</code></p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置Host行的值为:10.0.0.172</span></div><div class="line">请求 设置行值2 Host 10.0.0.172</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-4-删除一行"><a href="#2-1-4-删除一行" class="headerlink" title="2.1.4 删除一行"></a>2.1.4 删除一行</h4><p>删除请求中的一行</p>
<ul>
<li><p>原型<br><code>请求 删除一行 danme</code></p>
</li>
<li><p>参数</p>
<ul>
<li>参数1：<code>dname</code> 必填，需要删除的行名称</li>
</ul>
</li>
</ul>
<p>会删除请求中的<code>dname</code>行</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除请求中的Host行</span></div><div class="line">请求 删除一行 Host</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-5-删除一行2"><a href="#2-1-5-删除一行2" class="headerlink" title="2.1.5 删除一行2"></a>2.1.5 删除一行2</h4><p>删除请求中的一行（与<code>删除一行</code>一致）</p>
<ul>
<li><p>原型<br><code>请求 删除一行2 danme</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>dname</code> 必填，需要删除的行名称</li>
</ul>
</li>
</ul>
<p>会删除请求中的<code>dname</code>行</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除请求中的Host行</span></div><div class="line">请求 删除一行2 Host</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-6-替换字符串"><a href="#2-1-6-替换字符串" class="headerlink" title="2.1.6 替换字符串"></a>2.1.6 替换字符串</h4><p>替换请求中指定的字符串</p>
<ul>
<li><p>原型<br><code>请求 替换字符串 str1 str2</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>str1</code> 必填，需要被替换的字符串，支持<code>%[xxx]</code>操作</li>
<li>参数2：<code>str2</code> 必填 ，需要替换的字符串</li>
</ul>
</li>
</ul>
<p>在请求中，把<code>str1</code>字符串替换为<code>str2</code>字符串</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#修改HTTP协议版本为:1.0</span></div><div class="line">请求 替换字符串 HTTP/1.1 HTTP/1.0</div><div class="line"></div><div class="line"><span class="comment">#把Host行替换成X-Online-Host行</span></div><div class="line">请求 替换字符串 \nHost: \nX-Online-Host:</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-7-之前添加"><a href="#2-1-7-之前添加" class="headerlink" title="2.1.7 之前添加"></a>2.1.7 之前添加</h4><p>在请求中某一个字符串前面添加字符串</p>
<ul>
<li><p>原型<br><code>请求 之前添加 name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>name</code> 必填，确定在哪一个字符串前面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中的的<code>name</code>字符串前添加<code>str</code>字符串</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行前面添加一行：test,值为abc</span></div><div class="line">请求 之前添加 Host: test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-8-之后添加"><a href="#2-1-8-之后添加" class="headerlink" title="2.1.8 之后添加"></a>2.1.8 之后添加</h4><p>在请求中指定字符串后面添加字符串</p>
<ul>
<li><p>原型<br><code>请求 之后添加 name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>name</code> 必填，确定在哪个字符串后面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中的<code>name</code>行后面添加<code>str</code>字符串</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在首行下面添新的一行test 值为abc</span></div><div class="line">请求 之后添加 \n test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-9-行前添加"><a href="#2-1-9-行前添加" class="headerlink" title="2.1.9 行前添加"></a>2.1.9 行前添加</h4><p>在请求中某一行前面添加字符串</p>
<ul>
<li><p>原型<br><code>请求 行前添加 name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行前面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中的的<code>name</code>行前添加<code>str</code>字符串</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行前面添加一行：test,值为abc</span></div><div class="line">请求 行前添加 Host test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-10-行后添加"><a href="#2-1-10-行后添加" class="headerlink" title="2.1.10 行后添加"></a>2.1.10 行后添加</h4><p>在请求中某一行后面添加字符串</p>
<ul>
<li><p>原型<br><code>请求 行后添加 name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行后面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中的的<code>name</code>行后面添加<code>str</code>字符串</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行后面添加一行：test,值为abc</span></div><div class="line">请求 行后添加 Host test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-11-行值前添加"><a href="#2-1-11-行值前添加" class="headerlink" title="2.1.11 行值前添加"></a>2.1.11 行值前添加</h4><p>在一行值的前面添加字符串</p>
<ul>
<li><p>原型<br><code>请求 行值前添加 name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行值的前面添加字符串</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在请求中的的<code>name</code>的值前面添加添加<code>str</code>字符串</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行值前面添加字符串：abc</span></div><div class="line">请求 行值前添加 Host abc</div><div class="line"><span class="comment">#如果Host行整行为:Host: wap.baidu.com\r\n</span></div><div class="line"><span class="comment">#那么使用上面的Host行就会变成：Host:abcwap.baidu.com\r\n</span></div><div class="line"><span class="comment">#这个时候Host行值的前面增加了abc，这就是'行值前添加'语法的作用</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-12-行值后添加"><a href="#2-1-12-行值后添加" class="headerlink" title="2.1.12 行值后添加"></a>2.1.12 行值后添加</h4><ul>
<li><p>原型<br><code>请求 行值后添加 name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>name</code> 必填，确定在哪一行值的后面</li>
<li>参数2：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行值后面添加abc</span></div><div class="line">请求 行值后添加 Host abc</div><div class="line"><span class="comment">#如果Host行的整行为:Host: wap.baidu.com\r\n</span></div><div class="line"><span class="comment">#使用上面的语法后Host整行为：Host: wap.baidu.comabc\r\n</span></div><div class="line"><span class="comment">#这个时候Host行值后面添加了abc，这就是'行值后添加'语法的作用</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-13-URL前添加"><a href="#2-1-13-URL前添加" class="headerlink" title="2.1.13 URL前添加"></a>2.1.13 URL前添加</h4><ul>
<li><p>原型<br><code>请求 URL前添加 str</code></p>
</li>
<li><p>参数</p>
<ul>
<li>参数1：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在请求URL之前添加字符串str</span></div><div class="line">请求 URL前添加 str</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-14-URL后添加"><a href="#2-1-14-URL后添加" class="headerlink" title="2.1.14 URL后添加"></a>2.1.14 URL后添加</h4><ul>
<li><p>原型<br><code>请求 URL后添加 str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>str</code> 必填，需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">##在请求URL之后添加字符串str</span></div><div class="line">请求 URL后添加 str</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-15-删除网址http-host"><a href="#2-1-15-删除网址http-host" class="headerlink" title="2.1.15 删除网址http://host"></a>2.1.15 删除网址<code>http://host</code></h4><ul>
<li><p>原型<br><code>请求 删除网址http://host null null</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1： 可选，默认<code>null</code>即可</li>
<li>参数2： 可选，默认<code>null</code>即可</li>
</ul>
</li>
</ul>
<p>在请求的第一行通常是这样的<br><code>GET(method) http://wap.baidu.com/?from=xxx</code><br>由于某些特殊修改请求的方法，需要去掉请求中的<code>http://wap.baidu.com</code><br>所以出现了上面的语法，语法跟<code>mov-fhttp null null</code>作用一样</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除网址http://host</span></div><div class="line">请求 删除网址http://host null null</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-16-删除s-e"><a href="#2-1-16-删除s-e" class="headerlink" title="2.1.16 删除s_e"></a>2.1.16 删除s_e</h4><ul>
<li><p>原型<br><code>请求 删除s_e start end</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>start</code> 必填,开始字符</li>
<li>参数2：<code>end</code> 必填，结束字，支持<code>%[xxx]</code>操作符</li>
</ul>
</li>
</ul>
<p>删除<code>start</code>到<code>end</code>之间的字符，保留<code>end</code></p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除网址http://host</span></div><div class="line">请求 删除s_e http:// /</div><div class="line"><span class="comment">#上面的语句的作用就等于删除网址http://</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-17-删除s-e2"><a href="#2-1-17-删除s-e2" class="headerlink" title="2.1.17 删除s_e2"></a>2.1.17 删除s_e2</h4><ul>
<li><p>原型<br><code>请求 删除s_e2 start end</code></p>
</li>
<li><p>参数</p>
<ul>
<li>参数1：<code>start</code> 必填，开始的字符</li>
<li>参数2：<code>end</code> 结束的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>删除<code>start</code>到<code>end</code>的字符，删除<code>end</code>，跟<code>删除s_e</code>的区别就是<code>s_e</code>保留了<code>end</code>,这个语法删除了<code>end</code></p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除Host行</span></div><div class="line">请求 删除s_e2 Host \r\n</div><div class="line"><span class="comment">#上面的语法的意思是删除：以Host开头到以\r\n结尾的字符串，开头和结尾都删除</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-18-atob-a-b"><a href="#2-1-18-atob-a-b" class="headerlink" title="2.1.18 atob a b"></a>2.1.18 atob a b</h4><p>主要用于转换行头（行头就是一行的名字，通常有<code>host行</code>的叫法，就是因为行头为<code>Host</code>）<br>如果a行存在，那么行头就替换成b行，b行不管存不存在都会被删除<br>如果a行的值为空，那么a行将会被删除，b行保留</p>
<ul>
<li><p>原型<br><code>请求 atob a b</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>a</code> 必填，A行</li>
<li>参数2：<code>b</code> 必填，B行</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#X-Online-Host转Host</span></div><div class="line">请求 atob X-Online-Host Host</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-19-设置第一行-str"><a href="#2-1-19-设置第一行-str" class="headerlink" title="2.1.19 设置第一行 str"></a>2.1.19 设置第一行 str</h4><p>自定义请求的第一行</p>
<ul>
<li><p>原型<br><code>请求 设置第一行 str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：<code>str</code> 必填，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#具体事例 http://host转http://proxy_host</span></div><div class="line">请求 设置第一行 %[method]\ http://prxoy_host%[request_uri]\ HTTP/1.1\r\n</div><div class="line"><span class="comment">#%[method] 请求方法 GET/POST/CONNECT</span></div><div class="line"><span class="comment">#%[request_uri] 请求url 跟php的REQUEST_URI类似</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-1-20-设置行名-hdrA-hdrB"><a href="#2-1-20-设置行名-hdrA-hdrB" class="headerlink" title="2.1.20 设置行名 hdrA hdrB"></a>2.1.20 设置行名 hdrA hdrB</h4><p>设置一行请求的行名</p>
<ul>
<li><p>原型<br><code>请求 设置行名 hdrA hdrB</code></p>
</li>
<li><p>参数 </p>
<ul>
<li>参数1：`hdrA 需要被改名的请求行必填</li>
<li>参数1： 将要改为的行名</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Host行改为T_Host行</span></div><div class="line">请求 设置行名 Host T_Host</div><div class="line"><span class="comment">#就把Host行的行名：Host改为了T_Host</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-2-英语语法"><a href="#2-2-英语语法" class="headerlink" title="2.2 英语语法"></a>2.2 英语语法</h3><p>这里语法的作用都是同上面中文语法的<br>英文语法在后来的版本中对原来的语法进行优化和修复<br>在1.5版本后,set-header/2,del-header/2全部为自定义语法<br>这样做的目的是为了稳定性和安全性考虑</p>
<h4 id="2-2-1-add-header"><a href="#2-2-1-add-header" class="headerlink" title="2.2.1 add-header"></a>2.2.1 add-header</h4><p>添加一行</p>
<ul>
<li><p>原型<br><code>http-request add-header h v</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，需要添加的行</li>
<li><code>v</code>： 必填，需要添加行的值，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>添加新的一行，行头为<code>h</code>，值为<code>v</code></p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#添加test行，值为abc</span></div><div class="line">http-request add-header test abc</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-2-set-header"><a href="#2-2-2-set-header" class="headerlink" title="2.2.2 set-header"></a>2.2.2 set-header</h4><p>设置一行的值</p>
<ul>
<li><p>原型<br><code>http-request set-header h v</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，需要修改值的行</li>
<li><code>v</code>： 必填，需要修改的值，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>设置<code>h</code>行的值为<code>v</code>，不会修改位置</p>
<h4 id="2-2-3-set-header2"><a href="#2-2-3-set-header2" class="headerlink" title="2.2.3 set-header2"></a>2.2.3 set-header2</h4><p>设置一行的值</p>
<ul>
<li><p>原型<br><code>http-request set-header2 h v</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，需要修改值的行</li>
<li><code>v</code>： 必填，需要修改的值，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置Host行的值为10.0.0.172</span></div><div class="line">http-request set-header2 Host 10.0.0.172</div></pre></td></tr></table></figure>
</li>
</ul>
<p>2.2.4 del-header<br>删除请求中的一行</p>
<ul>
<li><p>原型<br><code>http-request del-header h</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，被删除的行头</li>
</ul>
</li>
</ul>
<p>删除请求中的<code>h</code>行</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除请求中的Host行</span></div><div class="line">http-request del-header Host</div></pre></td></tr></table></figure>
</li>
</ul>
<p>2.2.5 del-header2</p>
<p>删除请求中的一行，与<code>del-heder</code>语法的区别就是此语法更稳当，<code>del-header</code>语法为开发语法</p>
<ul>
<li><p>原型<br><code>http-request del-header2 h</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，被删除的行头</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除请求中Host行</span></div><div class="line">http-request del-header2 Host</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-6-add-replace-str-repalce"><a href="#2-2-6-add-replace-str-repalce" class="headerlink" title="2.2.6 add-replace(str_repalce)"></a>2.2.6 add-replace(str_repalce)</h4><p>替换请求中的字符串</p>
<ul>
<li><p>原型<br><code>http-request add-replace(str_replace) str1 str2</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>str1</code>： 必填，被替换的字符串，支持<code>%[xxx]</code>操作</li>
<li><code>str2</code>： 必填，替换的字符串</li>
</ul>
</li>
</ul>
<p>把请求中的<code>str1</code>字符串替换成<code>str2</code>字符串</p>
<p>示例<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#更改http协议版本为1.0</span></div><div class="line">http-request add-replace HTTP/1.1 HTTP/1.0</div></pre></td></tr></table></figure></p>
<h4 id="2-2-7-add-before"><a href="#2-2-7-add-before" class="headerlink" title="2.2.7 add-before"></a>2.2.7 add-before</h4><p>在指定字符串前面添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-before name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>name</code>： 必填，定位在哪个字符串前面添加字符串</li>
<li><code>str</code>： 必填，需要添加的字符串 ，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Host行前添加一行test,值为abc</span></div><div class="line">http-request add-before Host test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-8-add-after"><a href="#2-2-8-add-after" class="headerlink" title="2.2.8 add-after"></a>2.2.8 add-after</h4><p>在指定字符串后面添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-after name str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>name</code>： 必填，定位在哪个字符后面添加字符</li>
<li><code>str</code>： 必填，要添加的字符，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在首行下面添加一个Host 值为test</span></div><div class="line">http-rrequest add-after \n Host:\ test\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-9-add-lbefore"><a href="#2-2-9-add-lbefore" class="headerlink" title="2.2.9 add-lbefore"></a>2.2.9 add-lbefore</h4><p>在指定行之前添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-lbefore h str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，在指定的行前</li>
<li><code>str</code>： 必填， 添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行前添加新的一行test值为abc</span></div><div class="line">http-request add-lbeofore Host test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-10-add-lafter"><a href="#2-2-10-add-lafter" class="headerlink" title="2.2.10 add-lafter"></a>2.2.10 add-lafter</h4><p>在指定行后添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-lafter h str</code></p>
</li>
<li><p>参数</p>
<ul>
<li><code>h</code>： 必填，在指定的行后</li>
<li><code>str</code>： 必填， 添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行后添加新的一行:test行值为：abv</span></div><div class="line">http-request add-lafter Host test:\ abc\r\n</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-11-add-vbefore"><a href="#2-2-11-add-vbefore" class="headerlink" title="2.2.11 add-vbefore"></a>2.2.11 add-vbefore</h4><p>在指定行后的值前面添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-vbefore h v</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 必填，确定在哪一行值的前面添加字符串</li>
<li><code>v</code>： 必填，添加的字符串 ，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
</ul>
<p>在<code>h</code>行的值后面添加字符串<code>v</code></p>
<ul>
<li>示例<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行值前面添加字符串：abc</span></div><div class="line">http-request<span class="built_in"> add-vbefore </span>Host abc</div><div class="line"><span class="comment">#如果Host行整行为:Host: wap.baidu.com\r\n</span></div><div class="line"><span class="comment">#那么使用上面的Host行就会变成：Host:abcwap.baidu.com\r\n</span></div><div class="line"><span class="comment">#这个时候Host行值的前面增加了abc，这就是'add-hbefore'法的作用</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-12-add-vafter"><a href="#2-2-12-add-vafter" class="headerlink" title="2.2.12 add-vafter"></a>2.2.12 add-vafter</h4><p>在指定行的值后面添加</p>
<ul>
<li><p>原型<br><code>http-request add-vafter h v</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 指定哪个行值后面添加字符串</li>
<li><code>v</code>： 需要添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在Host行值后面添加abc</span></div><div class="line">http-request add-vafter Host abc</div><div class="line"><span class="comment">#如果Host行的整行为:Host: wap.baidu.com\r\n</span></div><div class="line"><span class="comment">#使用上面的语法后Host整行为：Host: wap.baidu.comabc\r\n</span></div><div class="line"><span class="comment">#这个时候Host行值后面添加了abc</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-13-add-ubfore"><a href="#2-2-13-add-ubfore" class="headerlink" title="2.2.13 add-ubfore"></a>2.2.13 add-ubfore</h4><p>在请求URL前面添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-ubefore str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>str</code>： 添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在请求url前添加'http://bml.net'</span></div><div class="line">http-request ubefore http://byml.net</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-14-add-uafter"><a href="#2-2-14-add-uafter" class="headerlink" title="2.2.14 add-uafter"></a>2.2.14 add-uafter</h4><p>在请求URL之后添加字符串</p>
<ul>
<li><p>原型<br><code>http-request add-uafter str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>str</code>： 添加的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#在请求URL后面添加字符串?abc</span></div><div class="line">http-request add-uafter ?abc</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-15-atob-a-b"><a href="#2-2-15-atob-a-b" class="headerlink" title="2.2.15 atob a b"></a>2.2.15 atob a b</h4><p>a行转b行</p>
<ul>
<li><p>原型<br><code>http-request atob a b</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>a</code>： a行</li>
<li><code>b</code>： b行</li>
</ul>
</li>
</ul>
<p>如果a行存在，b行存在，则会把b行删除，把a行的行头改成b<br>如果a行的值为空，则会删除a行，保留b行<br>如果a行不存在，则不会做任何处理</p>
<ul>
<li>示例<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#X-Online-Host转Host</span></div><div class="line">http-request atob X-Online-Host Host</div></pre></td></tr></table></figure>
</li>
</ul>
<p>####2.2.16 rep-hvalue<br>修改一行的值，如果不存在行就不添加</p>
<ul>
<li><p>原型<br><code>http-request rep-hvalue h v</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>h</code>： 修改值的行</li>
<li><code>v</code>： 需要修改成的值，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#修改host行的值为byml.net，如果不存在则不做任何处理</span></div><div class="line">http-request rep-havlue Host byml.net</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-17-mov-fhttp"><a href="#2-2-17-mov-fhttp" class="headerlink" title="2.2.17 mov-fhttp"></a>2.2.17 mov-fhttp</h4><p>删除请求网址开头：<code>http://host</code></p>
<ul>
<li><p>原型<br><code>http-request mov-fhttp null null</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>null</code>： 默认即可</li>
<li><code>null</code>： 默认即可，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#使用例子</span></div><div class="line">http-request mov-fhttp null null</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-18-mov-se-s-e"><a href="#2-2-18-mov-se-s-e" class="headerlink" title="2.2.18 mov-se s e"></a>2.2.18 mov-se s e</h4><p>删除以<code>s</code>开头到<code>e</code>结尾的字符串，保留<code>e</code></p>
<ul>
<li><p>原型<br><code>http-request mov-se s e</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>s</code>： 开始的字符串</li>
<li><code>e</code>： 结束的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除请求地址中的http://host</span></div><div class="line">http-request mov-se http:// /</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-19-mov-nse-s-e"><a href="#2-2-19-mov-nse-s-e" class="headerlink" title="2.2.19 mov-nse s e"></a>2.2.19 mov-nse s e</h4><p>删除以<code>s</code>开头到<code>e</code>结尾的字符串，删除<code>e</code></p>
<ul>
<li><p>原型<br><code>http-request mov-nse s e</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>s</code>： 开始的字符串</li>
<li><code>e</code>： 结束的字符串，支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#删除Host行</span></div><div class="line">http-request mov-nse Host \r\n</div><div class="line"><span class="comment">#一行的结束标志是\r\n</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-20-set-req-fline-str"><a href="#2-2-20-set-req-fline-str" class="headerlink" title="2.2.20 set-req-fline str"></a>2.2.20 set-req-fline str</h4><p>自定义请求的第一行</p>
<ul>
<li><p>原型<br><code>http-request set-req-fline str</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>str</code>： 支持<code>%[xxx]</code>操作</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#http://host转http://proxy_host</span></div><div class="line">http-request set-req-fline %[method]\ http://proxy_host%[request_uri]\ HTTP/1.1\r\n </div><div class="line"><span class="comment">#%[method] 请求方法 GET/POST/CONNECT</span></div><div class="line"><span class="comment">#%[request_uri] 请求的url 跟php的REQUEST_URI类似</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-21-rn-header-hdrA-hdrB"><a href="#2-2-21-rn-header-hdrA-hdrB" class="headerlink" title="2.2.21 rn-header hdrA hdrB"></a>2.2.21 rn-header hdrA hdrB</h4><p>设置一行请求的行名</p>
<ul>
<li><p>原型<br><code>http-request rn-header hdrA hdrB</code></p>
</li>
<li><p>参数 </p>
<ul>
<li><code>hdrA</code>： 被改名的请求行</li>
<li><code>hdrB</code>： 需要改为的名称</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#Host行改为T_Host</span></div><div class="line">http-request rn-header Host T_Host</div><div class="line"><span class="comment">#把Host行的请求名：Host 改为了T_Host</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="2-2-22-xhostTot"><a href="#2-2-22-xhostTot" class="headerlink" title="2.2.22 xhostTot"></a>2.2.22 xhostTot</h4><p><code>Xhost</code>,<code>Host</code>（如果没有大写的，则自动查找小写）转换为<code>T_Host</code><br>如果<code>xhost</code>,<code>host</code>均存在<br>则以<code>xhost</code>优先，把<code>xhost</code>请求行名改为<code>T_Host</code><br>如果<code>host</code>行存在，<code>xhost</code>不存在<br>则以<code>host</code>行优先，把<code>host</code>行改为<code>T_Host</code>行</p>
<ul>
<li><p>原型<br><code>http-request xhostTot null null</code></p>
</li>
<li><p>参数</p>
<ul>
<li><code>null</code>： 无作用，但必须加</li>
<li><code>null</code>： 无作用，但必须加</li>
</ul>
</li>
<li><p>示例</p>
</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http-request xhostTot null null</div></pre></td></tr></table></figure>
<h2 id="3-特殊用法"><a href="#3-特殊用法" class="headerlink" title="3.特殊用法"></a>3.特殊用法</h2><h3 id="3-1-xxx-操作"><a href="#3-1-xxx-操作" class="headerlink" title="3.1 %[xxx]操作"></a>3.1 <code>%[xxx]</code>操作</h3><p><code>%[xxx]</code>操作就相当于变量，到了核心就会被转换成这个变量存储的数据</p>
<h4 id="3-1-0-header-xxxx"><a href="#3-1-0-header-xxxx" class="headerlink" title="3.1.0  %[header(xxxx)]"></a>3.1.0  <code>%[header(xxxx)]</code></h4><p>例如：<code>%[header(Host)]</code><br>就是取：Host行的值<br>这个语法为新增加语法，更适合编写模式</p>
<h4 id="3-1-1-url"><a href="#3-1-1-url" class="headerlink" title="3.1.1 %[url]"></a>3.1.1 <code>%[url]</code></h4><p>如果请求的第一行为：<code>GET http://byml.net/index.php HTTP/1.1\r\n</code><br>那么<code>%[url]</code>代表的是<code>http://byml.net/index.php</code></p>
<h4 id="3-1-2-request-uri"><a href="#3-1-2-request-uri" class="headerlink" title="3.1.2 %[request_uri]"></a>3.1.2 <code>%[request_uri]</code></h4><p>如果请求的第一行为：<code>GET http://byml.net/index.php?user=recall HTTP/1.1\r\n</code><br>那么<code>%[request_uri]</code>代表的是：<code>/index.php?user=recall</code></p>
<h4 id="3-1-3-req-hdr-xxx"><a href="#3-1-3-req-hdr-xxx" class="headerlink" title="3.1.3 %[req.hdr(xxx)]"></a>3.1.3 <code>%[req.hdr(xxx)]</code></h4><p>例如：<code>%[req.hdr(Accept)]</code><br>就是取<code>Accept</code>行的值</p>
<p>如果是要取<code>Host</code>的值<br>推荐使用<code>%[host]</code>，这个是固定的，不会出现取值失败，自动停止等BUG</p>
<h4 id="3-1-4-method"><a href="#3-1-4-method" class="headerlink" title="3.1.4 %[method]"></a>3.1.4 <code>%[method]</code></h4><p>如果当前的请求方式为<code>GET</code><br>那么<code>%[method]</code>的值就是<code>GET</code></p>
<h4 id="3-1-5-req-ver"><a href="#3-1-5-req-ver" class="headerlink" title="3.1.5 %[req.ver]"></a>3.1.5 <code>%[req.ver]</code></h4><p><code>req.ver</code>是当前使用的HTTP协议的版本<br>如果请求是HTTP/1.1 <code>%[req.ver]</code>则为<code>1.1</code><br>如果请求是HTTP/1.0 <code>%[req.ver]</code>则为<code>1.0</code></p>
<h4 id="3-1-6-url-no-port"><a href="#3-1-6-url-no-port" class="headerlink" title="3.1.6 %[url_no_port]"></a>3.1.6 <code>%[url_no_port]</code></h4><p>如果<code>CONNECT</code>请求的第一行为<code>CONNECT byml.net:443 HTTP/1.1\r\n</code><br>那么<code>%[url_no_port]</code>代表<code>byml.net</code>，目前只推荐在<code>CONNECT</code>请求中使用</p>
<h4 id="3-1-7-host"><a href="#3-1-7-host" class="headerlink" title="3.1.7 %[host]"></a>3.1.7 <code>%[host]</code></h4><p>取<code>Host</code>行的值，解决<code>atob</code>后，<code>%[req.hdr(Host)]</code>取不到值的BUG</p>
<h4 id="3-1-8-t-host"><a href="#3-1-8-t-host" class="headerlink" title="3.1.8 %[t_host]"></a>3.1.8 <code>%[t_host]</code></h4><p>取<code>T_Host</code>行的值，可以先把<code>Host</code>字符串修改成<code>T_Host</code><br>这样就可以直接<code>%[t_host]</code>取到<code>Host</code>的值，而且只需要定义第一行就行了 </p>
<h4 id="3-1-9-xhost"><a href="#3-1-9-xhost" class="headerlink" title="3.1.9 %[xhost]"></a>3.1.9 <code>%[xhost]</code></h4><p>取<code>X-Online-Host</code>行的值，固定搭配</p>
<h3 id="3-2-核心函数"><a href="#3-2-核心函数" class="headerlink" title="3.2 核心函数"></a>3.2 核心函数</h3><h4 id="3-2-1-未完待续"><a href="#3-2-1-未完待续" class="headerlink" title="3.2.1 未完待续"></a>3.2.1 未完待续</h4></div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a data-url="https://hyxxsfwy.github.io/2016/01/30/HaP-免流模式语法帮助文档/" data-id="cj2z1h7vd0000msjge9ctt06k" class="article-share-link">分享</a><div class="tags"><a href="/tags/免流/">免流</a><a href="/tags/帮助/">帮助</a><a href="/tags/HAProxy/">HAProxy</a></div><div class="post-nav"><a href="/2016/06/01/【转】边信道攻击，从米特尼克传奇重现说起/" class="pre">【转】边信道攻击，从米特尼克传奇重现说起</a><a href="/2016/01/16/【转】如何在死线未至时，像死线已至那样高效？/" class="next">【转】如何在死线未至时，像死线已至那样高效？</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'hyxxsfwy';
var disqus_identifier = '2016/01/30/HaP-免流模式语法帮助文档/';
var disqus_title = 'HaP 免流模式语法帮助文档';
var disqus_url = 'https://hyxxsfwy.github.io/2016/01/30/HaP-免流模式语法帮助文档/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//hyxxsfwy.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/学习/">学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻墙/">翻墙</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Hack-Security/" style="font-size: 15px;">Hack&Security</a> <a href="/tags/免流/" style="font-size: 15px;">免流</a> <a href="/tags/HAProxy/" style="font-size: 15px;">HAProxy</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/LaTex/" style="font-size: 15px;">LaTex</a> <a href="/tags/教程/" style="font-size: 15px;">教程</a> <a href="/tags/信息安全/" style="font-size: 15px;">信息安全</a> <a href="/tags/边信道攻击/" style="font-size: 15px;">边信道攻击</a> <a href="/tags/帮助/" style="font-size: 15px;">帮助</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/翻墙/" style="font-size: 15px;">翻墙</a> <a href="/tags/XX-Net/" style="font-size: 15px;">XX-Net</a> <a href="/tags/Google/" style="font-size: 15px;">Google</a> <a href="/tags/Hello/" style="font-size: 15px;">Hello</a> <a href="/tags/GTD/" style="font-size: 15px;">GTD</a> <a href="/tags/时间管理/" style="font-size: 15px;">时间管理</a> <a href="/tags/拖延症/" style="font-size: 15px;">拖延症</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/【转】现代密码学实践指南-2015年/">【转】现代密码学实践指南【2015年】</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/18/搜集可用于XX-Net的高速GGC-IP段/">搜集可用于 XX-Net 的高速 GGC IP 段</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/01/【转】边信道攻击，从米特尼克传奇重现说起/">【转】边信道攻击，从米特尼克传奇重现说起</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/30/HaP-免流模式语法帮助文档/">HaP 免流模式语法帮助文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/16/【转】如何在死线未至时，像死线已至那样高效？/">【转】如何在死线未至时，像死线已至那样高效？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/15/Hexo-Markdown-简明语法手册/">Hexo Markdown 简明语法手册</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/14/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//hyxxsfwy.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Mobilicorpus.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.1"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>